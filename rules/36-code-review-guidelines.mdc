---
description: コードレビューの観点、コメントの基準、マージ判断のガイドラインを定義します。レビュー品質の均質化と心理的安全性の確保を目的とします。
globs: [".github/pull_request_template.md"]
---

# 36. コードレビューガイドライン (Code Review Guidelines)

- Description: コードレビューは「粗探し」ではなく「品質向上と知識共有の場」です。AIによるレビューも含め、建設的で効率的なプロセスを目指します。

# 1. レビュー観点 (Checklist)

以下の優先順位でチェックしてください。

1.  **機能的正確性 (Correctness)**: 要件を満たしているか？バグはないか？
2.  **セキュリティ (Security)**: `23-security-policy.mdc` に違反していないか？（XSS, SQLi, 権限漏れ）
3.  **可読性と保守性 (Readability)**: 変数名は適切か？複雑すぎないか？DRY/KISS原則に従っているか？
4.  **テスト (Tests)**: テストコードは含まれているか？カバレッジは十分か？
5.  **スタイル (Style)**: Lintで自動修正できる内容は人間が指摘しない。

# 2. コメントのレベル分け (Comment Labels)

コメントの冒頭にラベルを付け、意図を明確にします。

- **[MUST]**: 必ず修正が必要。マージ不可（Blocker）。
    - 例: バグ、セキュリティリスク、明白な仕様違反。
- **[IMO] (In My Opinion)**: 修正した方が良いと思うが、実装者に任せる。マージ可。
    - 例: より良い変数名の提案、可読性向上のための提案。
- **[ASK]**: 質問、確認。意図が分からない場合など。
- **[nits] (Nitpick)**: 細かい指摘。修正しなくてもマージ可。
    - 例: タイポ、コメントの軽微な修正。

# 3. 心理的安全性 (Psychological Safety)

- **人格ではなくコードを指摘する**: "You are wrong" ではなく "This code might cause..." と書く。
- **良い点は褒める**: "[Good]", "[Nice]" などのコメントも積極的に残す。
- **AIレビューの活用**: 単純なミスやスタイル指摘はAIに任せ、人間は設計やロジックの妥当性に集中する。

# 4. レビューモードのデフォルト（コンテキスト最適化）

**重要**: `46-context-optimization-and-model-selection.mdc` に従い、レビュー時は**diff優先・最小コンテキスト優先**をデフォルトとする。

## 4.1 レビュー依頼時のデフォルト動作

**デフォルト**: git diff優先、または変更ファイル + 変更箇所のみ

1. **git diff を要求**（変更箇所のみをレビュー）
   OR
2. **変更ファイルリスト + 変更箇所**（diffが取得できない場合）

**diffが不十分な場合のみ**:
- 変更箇所の周辺コードを読み込む（前後50-100行程度）
- 関連ファイルを読み込む（依存関係がある場合のみ）

**プロジェクト全体のレビュー依頼の場合**:
- README.md を先に読む（200行未満の場合のみ全体読み込み）
- 主要エントリーポイントのみを読み込む（範囲指定推奨）
- 問題箇所を特定したら、その周辺のみを詳細に読み込む

## 4.2 レビュー優先順位

1. **正確性 (Correctness)**: 要件を満たしているか？バグはないか？
2. **セキュリティ (Security)**: `23-security-policy.mdc` に違反していないか？
3. **パフォーマンス (Performance)**: パフォーマンス問題はないか？
4. **保守性 (Maintainability)**: 可読性、DRY/KISS原則に従っているか？

# 5. AIへの指示

- 「このPRのコードをレビューして。【DIFF】git diffを優先して、変更箇所のみをレビューして。セキュリティとエッジケースの観点で [MUST] な問題があれば指摘して。細かいスタイル指摘は [nits] としてまとめて。」
- 「この関数の命名が分かりにくいので、[IMO] ラベルで代替案を3つ提案して。」
