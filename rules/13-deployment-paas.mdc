---
alwaysApply: false
---
Description: VercelやRailwayのようなPaaS (Platform as a Service) にアプリケーションをデプロイする際の、設定やベストプラクティスを定義します。デプロイに関する質問があった場合に適用してください。

# 1. 環境変数はプラットフォームのダッシュボードで管理する
- **考え方**: ローカル開発では`.env`ファイルを使いますが、本番環境の機密情報はVercelやRailwayのWebサイト上にある、環境変数管理ダッシュボードで設定します。Gitリポジトリには絶対に機密情報を含めない、という原則を徹底します。
- **実践方法**: VercelやRailwayのプロジェクト設定画面から、ローカルの`.env`ファイルと同じキーと値のペアを一つずつ設定していきます。
- **AIへの指示**: 「Vercelの環境変数には、`Production`, `Preview`, `Development`の3種類があるけど、それぞれの使い分けを教えてほしい。」

# 2. プラットフォーム固有の設定ファイルを活用する
- **考え方**: 各プラットフォームは、`vercel.json`や`railway.json`といった設定ファイルを通じて、より高度なデプロイ設定を提供しています。リダイレクト、カスタムヘッダー、サーバーレス関数のリージョン指定など、細かい制御が必要な場合に活用しましょう。
- **`vercel.json` の例**:
    ```json
    {
      "redirects": [
        { "source": "/old-path", "destination": "/new-path", "permanent": true }
      ]
    }
    ```
- **AIへの指示**: 「Next.jsアプリケーションで、特定のパス(`/api/legacy`)へのアクセスを、別のパス(`/api/v2`)にリダイレクトさせたい。`vercel.json`での書き方を教えて。」

# 3. デプロイログを注意深く読む
- **考え方**: デプロイが失敗したとき、その原因はほぼ全てデプロイログに書かれています。「デプロイに失敗しました」で思考停止せず、ログを一番下から注意深く読み解くことで、依存関係の不足、ビルドエラー、環境変数の設定ミスなど、具体的な問題を発見できます。
- **AIへの指示**: 「Vercelのデプロイでこんなエラーが出たんだけど、原因は何が考えられるかな？ [ここにエラーログを貼り付け]」

# 4. サーバーレス関数の特性を理解する
- **考え方**: VercelやRailwayのバックエンド機能は、サーバーレス関数として実行されることが多いです。これらは、リクエストがあった時だけ起動するため効率的ですが、いくつかの特性があります。
    - **ステートレス**: 関数は実行が終わると状態を保持しません。データベースや外部キャッシュを使いましょう。
    - **コールドスタート**: しばらくアクセスがないと関数は「スリープ」し、次のリクエスト時に起動時間が少し長くなることがあります。
    - **タイムアウト**: 関数の実行時間には上限があります（例: 10秒）。時間のかかる重い処理には向きません。
- **AIへの指示**: 「この重い画像処理、Vercelのサーバーレス関数で実行するとタイムアウトしてしまう。どういう対策が考えられるかな？」